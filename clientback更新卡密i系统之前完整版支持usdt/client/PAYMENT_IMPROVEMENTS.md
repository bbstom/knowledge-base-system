# 支付模块改进方案

## 问题清单

### 1. 套餐配置持久化问题 ❌
**现状**: 管理员配置的套餐保存后，刷新页面会丢失
**原因**: 数据只保存到localStorage，没有保存到数据库
**解决**: 修改保存逻辑，确保数据写入MongoDB

### 2. 购买流程冗余 ❌
**现状**: 用户选择套餐后跳转到"账户充值"页面，需要再次输入金额
**问题**: 流程繁琐，用户体验差
**解决**: 直接从套餐跳转到支付页面，自动填充金额

### 3. 货币单位不统一 ❌
**现状**: 系统使用人民币（CNY）作为基础货币
**问题**: 全网应该使用美元（USD）作为标准
**影响**: 
- 积分套餐价格
- VIP套餐价格
- 佣金计算
- 提现金额
**解决**: 统一改为美元（USD）

## 解决方案

### 方案1: 修复套餐配置持久化

#### 后端API修改
确保`/api/site-config`接口正确保存和读取套餐配置

#### 前端修改
1. 保存时同时写入数据库和localStorage
2. 加载时优先从数据库读取
3. 添加加载状态提示

### 方案2: 简化购买流程

#### 流程优化
```
旧流程:
充值中心 → 选择套餐 → 账户充值页面 → 输入金额 → 选择币种 → 支付

新流程:
充值中心 → 选择套餐 → 直接支付（自动填充金额和币种）
```

#### 实现方式
1. 点击套餐直接创建订单
2. 显示支付二维码
3. 轮询查询支付状态

### 方案3: 统一使用美元

#### 修改范围
1. **套餐价格**: CNY → USD
2. **订单金额**: CNY → USD  
3. **佣金金额**: CNY → USD
4. **提现金额**: CNY → USD
5. **显示文本**: ¥ → $

#### 汇率处理
- USDT: 1 USDT = 1 USD
- TRX: 实时汇率（从BEpusdt获取）

## 实施步骤

### Step 1: 修复配置持久化 ✅
- [ ] 检查SiteConfig模型
- [ ] 修改保存逻辑
- [ ] 测试配置保存和读取

### Step 2: 简化购买流程 ✅
- [ ] 修改RechargeCenter组件
- [ ] 创建直接支付组件
- [ ] 移除冗余的充值页面

### Step 3: 货币单位统一 ✅
- [ ] 修改套餐配置（CNY → USD）
- [ ] 修改订单创建逻辑
- [ ] 修改佣金计算逻辑
- [ ] 修改提现逻辑
- [ ] 更新所有显示文本

### Step 4: 测试验证 ✅
- [ ] 测试套餐配置保存
- [ ] 测试购买流程
- [ ] 测试支付功能
- [ ] 测试佣金计算
- [ ] 测试提现功能

## 预期效果

### 用户体验
- ✅ 购买流程更简单（减少2个步骤）
- ✅ 价格显示更清晰（统一美元）
- ✅ 支付更快捷（一键购买）

### 管理体验
- ✅ 配置持久化（不会丢失）
- ✅ 价格管理更方便（美元标准）
- ✅ 数据统计更准确

### 技术改进
- ✅ 数据库存储（可靠性提升）
- ✅ 代码简化（减少冗余）
- ✅ 货币统一（避免混乱）

## 注意事项

1. **数据迁移**: 需要将现有CNY价格转换为USD
2. **汇率**: USDT按1:1，TRX需要实时汇率
3. **显示**: 所有¥符号改为$
4. **兼容性**: 确保旧订单数据正常显示
