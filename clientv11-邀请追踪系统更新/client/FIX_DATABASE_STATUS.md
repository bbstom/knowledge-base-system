# 数据库状态功能修复

## 问题
用户界面的数据清单页面总是显示"维护中"状态，而不是根据管理员设置的状态显示。

## 解决方案

### 1. 数据库模型 (server/models/Database.js)
已包含`status`字段，支持三种状态：
- `normal` - 正常（默认）
- `maintenance` - 维护中
- `offline` - 已下线

### 2. 管理员后台 (src/pages/Admin/ContentManagement.tsx)
✅ 添加了状态选择下拉框
- 管理员可以为每个数据库设置状态
- 新建数据库时默认状态为"正常"
- 状态和启用/禁用是独立的两个字段

### 3. 前端显示 (src/pages/Databases.tsx)
✅ 根据status字段显示不同颜色的标签
- 正常：绿色标签
- 维护中：黄色标签
- 已下线：灰色标签

### 4. API返回 (server/routes/search.js)
✅ 搜索API返回数据库列表时包含status和isActive字段

## 使用说明

### 管理员操作
1. 进入"内容管理 → 数据清单"
2. 点击"添加数据清单"或编辑现有数据库
3. 在"状态"下拉框中选择：
   - **正常** - 数据库运行正常，可以正常搜索
   - **维护中** - 数据库正在维护，但仍可访问
   - **已下线** - 数据库已下线，不建议使用
4. 保存后，前端用户界面会显示相应的状态标签

### 状态说明
- **状态字段** - 显示数据库的运行状态（正常/维护中/已下线）
- **启用字段** - 控制数据库是否在列表中显示

两个字段是独立的，可以组合使用：
- 启用 + 正常 = 正常显示和使用
- 启用 + 维护中 = 显示但提示维护中
- 启用 + 已下线 = 显示但提示已下线
- 禁用 = 不在列表中显示

## 修改的文件
1. `src/pages/Admin/ContentManagement.tsx` - 添加状态选择，新建时默认status为'normal'
2. `src/pages/Databases.tsx` - 显示状态标签
3. `server/routes/search.js` - 返回status字段
4. `server/routes/database.js` - 创建和更新路由支持status字段

## 关键修复

### 问题1：后端保存不了status
**问题根源：** 后端的创建和更新路由没有处理`status`字段，导致保存后状态丢失。

**解决方案：**
- ✅ POST路由：接收并保存status字段，默认为'normal'
- ✅ PUT路由：接收并更新status字段
- ✅ 添加调试日志：`console.log('📝 更新数据库请求体:', req.body)`

### 问题2：前端显示不了status
**问题根源：** `server/routes/search.js`的`/databases`接口在查询时使用`.select()`只选择了部分字段，**没有包含`status`字段**。

**解决方案：**
- ✅ 在`.select()`中添加`status`和`isActive`字段
- ✅ 添加调试日志确认返回的数据包含status

## 测试建议
1. 创建新数据库，确认默认状态为"正常"
2. 修改数据库状态为"维护中"，保存后刷新页面确认状态保持
3. 修改数据库状态为"已下线"，保存后刷新页面确认状态保持
4. 测试三种状态的颜色显示是否正确
5. 查看服务器日志，确认status字段正确传递
