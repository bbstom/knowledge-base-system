# 用户中心功能测试指南

## 🧪 测试前准备

1. **确保服务器运行**
   ```bash
   cd server
   npm start
   ```

2. **确保前端运行**
   ```bash
   npm run dev
   ```

3. **登录用户账号**
   - 注册或登录一个测试账号
   - 确保账号有足够的积分

## 📝 测试步骤

### 1. 测试搜索历史

#### 步骤1：进行搜索
1. 进入"信息搜索"页面
2. 选择搜索类型（如：手机号）
3. 输入查询内容
4. 点击"开始搜索"
5. 等待搜索完成

#### 步骤2：查看搜索历史
1. 进入"用户中心 → 搜索历史"
2. 检查是否显示刚才的搜索记录
3. 验证显示的信息：
   - ✅ 搜索时间
   - ✅ 搜索类型
   - ✅ 查询内容
   - ✅ 搜索的数据库数量
   - ✅ 结果数量
   - ✅ 消耗积分
   - ✅ 搜索耗时

#### 步骤3：测试筛选功能
1. 使用状态筛选器
2. 使用时间范围筛选器
3. 验证筛选结果正确

#### 步骤4：测试分页
1. 进行多次搜索（超过20次）
2. 检查分页是否正常工作
3. 点击"上一页"/"下一页"测试

#### 步骤5：测试导出
1. 点击"导出记录"按钮
2. 检查是否下载CSV文件
3. 打开CSV文件验证数据

### 2. 测试推荐奖励

#### 步骤1：获取推荐码
1. 进入"用户中心 → 推荐奖励"
2. 查看你的推荐码
3. 复制推荐链接

#### 步骤2：推荐新用户
1. 使用推荐链接注册新用户
2. 或在注册时输入推荐码
3. 完成新用户注册

#### 步骤3：查看推荐统计
1. 刷新推荐奖励页面
2. 验证显示的信息：
   - ✅ 推荐人数增加
   - ✅ 总收益增加
   - ✅ 被推荐用户列表中显示新用户

#### 步骤4：查看佣金记录
1. 滚动到佣金记录部分
2. 检查是否有新的佣金记录
3. 验证佣金金额正确

### 3. 测试积分记录

#### 步骤1：进行充值
1. 进入"充值中心"
2. 选择充值金额
3. 完成充值（测试环境可能需要模拟）

#### 步骤2：查看充值记录
1. 进入"用户中心 → 积分记录"
2. 检查是否显示充值记录
3. 验证显示的信息：
   - ✅ 类型：充值（绿色）
   - ✅ 金额：+充值金额
   - ✅ 变动前余额
   - ✅ 变动后余额
   - ✅ 时间

#### 步骤3：进行搜索消费
1. 进行一次付费搜索
2. 返回积分记录页面
3. 检查是否显示搜索消费记录
4. 验证显示的信息：
   - ✅ 类型：搜索消费（红色）
   - ✅ 金额：-消耗积分
   - ✅ 描述：搜索类型和内容

#### 步骤4：查看推荐奖励
1. 如果有推荐新用户
2. 检查是否显示推荐奖励记录
3. 验证显示的信息：
   - ✅ 类型：推荐奖励（紫色）
   - ✅ 金额：+奖励积分

#### 步骤5：测试刷新和加载更多
1. 点击刷新按钮
2. 滚动到底部
3. 点击"加载更多"
4. 验证是否加载更多记录

## ✅ 验证清单

### 搜索历史
- [ ] 搜索后自动保存记录
- [ ] 显示完整的搜索信息
- [ ] 筛选功能正常工作
- [ ] 分页功能正常工作
- [ ] 统计数据正确
- [ ] 导出CSV功能正常

### 推荐奖励
- [ ] 显示推荐码
- [ ] 显示推荐统计
- [ ] 显示被推荐用户列表
- [ ] 显示佣金记录
- [ ] 推荐新用户后数据更新

### 积分记录
- [ ] 显示所有类型的积分变动
- [ ] 充值记录正确显示
- [ ] 消费记录正确显示
- [ ] 推荐奖励记录正确显示
- [ ] 显示变动前后余额
- [ ] 刷新功能正常
- [ ] 加载更多功能正常

## 🐛 常见问题

### 问题1：搜索历史不显示
**原因**：搜索时可能没有保存记录
**解决**：
1. 检查服务器日志
2. 确认SearchLog模型正确
3. 检查搜索API是否保存记录

### 问题2：推荐统计不更新
**原因**：新用户注册时可能没有关联推荐人
**解决**：
1. 检查注册API
2. 确认referredBy字段正确保存
3. 检查User模型

### 问题3：积分记录不显示
**原因**：积分变动时可能没有创建BalanceLog
**解决**：
1. 检查所有积分变动的代码
2. 确认都创建了BalanceLog记录
3. 检查BalanceLog模型

### 问题4：分页不工作
**原因**：API返回的分页信息可能不正确
**解决**：
1. 检查API响应
2. 确认pagination对象正确
3. 检查前端分页逻辑

## 📊 测试数据示例

### 搜索历史记录
```json
{
  "_id": "...",
  "userId": "...",
  "searchType": "phone",
  "searchQuery": "13800138000",
  "resultsCount": 5,
  "pointsCharged": 10,
  "searchTime": 1234,
  "databasesSearched": 3,
  "createdAt": "2024-01-01T12:00:00Z"
}
```

### 积分记录
```json
{
  "_id": "...",
  "userId": "...",
  "type": "search",
  "amount": -10,
  "balanceBefore": 100,
  "balanceAfter": 90,
  "description": "搜索消费：phone - 13800138000",
  "createdAt": "2024-01-01T12:00:00Z"
}
```

### 推荐统计
```json
{
  "referralCode": "ABC123",
  "totalReferrals": 5,
  "totalEarnings": 250,
  "referredUsers": [
    {
      "username": "user1",
      "createdAt": "2024-01-01T12:00:00Z"
    }
  ]
}
```

## 🎉 测试完成

如果所有测试都通过，说明用户中心功能已经完善！

用户现在可以：
- ✅ 查看完整的搜索历史
- ✅ 查看推荐奖励和佣金
- ✅ 查看所有积分变动记录

所有数据都从数据库获取，真实可靠！
