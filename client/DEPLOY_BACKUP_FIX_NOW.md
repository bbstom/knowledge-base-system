# ğŸš€ ç«‹å³éƒ¨ç½²å¤‡ä»½ä¿®å¤åˆ°ç”Ÿäº§æœåŠ¡å™¨

## âœ… ä»£ç å·²æ¨é€åˆ° GitHub

ä¿®å¤ä»£ç å·²æˆåŠŸæ¨é€åˆ°ï¼š
- Repository: `https://github.com/bbstom/knowledge-base-system.git`
- Branch: `main`
- Commit: ä¿®å¤æ•°æ®åº“å¤‡ä»½ä¸ºç©ºé—®é¢˜ - æ·»åŠ åŸç”Ÿé©±åŠ¨é™çº§é€»è¾‘

## ğŸ“‹ åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤

### æ­¥éª¤ 1: è¿æ¥åˆ°ç”Ÿäº§æœåŠ¡å™¨

```bash
ssh root@your-server-ip
```

### æ­¥éª¤ 2: è¿›å…¥é¡¹ç›®ç›®å½•

```bash
cd /var/www/html/knowledge-base-system
```

### æ­¥éª¤ 3: å¤‡ä»½å½“å‰ä»£ç ï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
cp -r server/services/backupService.js server/services/backupService.js.backup-$(date +%Y%m%d)
```

### æ­¥éª¤ 4: æ‹‰å–æœ€æ–°ä»£ç 

```bash
git pull origin main
```

ä½ åº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡ºï¼š
```
remote: Enumerating objects: ...
Updating a5dd292..8cf36d0
Fast-forward
 server/services/backupService.js              | XX +++++++++++++++
 server/scripts/checkBackupContent.js          | XX ++++++++++++++
 server/scripts/checkProductionBackupService.js| XX ++++++++++++++
 server/scripts/diagnoseBackup.js              | XX ++++++++++++++
 server/scripts/testBackupNow.js               | XX ++++++++++++++
 ...
```

### æ­¥éª¤ 5: éªŒè¯ä»£ç æ›´æ–°

```bash
cd server
node scripts/checkProductionBackupService.js
```

é¢„æœŸè¾“å‡ºï¼š
```
ğŸ” æ£€æŸ¥ backupService.js ä¿®å¤çŠ¶æ€...

ğŸ“‹ æ£€æŸ¥ç»“æœï¼š

âœ… backupDatabaseWithDriver: å­˜åœ¨
âœ… backupDatabaseWithMongodump: å­˜åœ¨
âœ… é™çº§é€»è¾‘: å­˜åœ¨
âœ… åŸç”Ÿé©±åŠ¨å¤‡ä»½: å­˜åœ¨

============================================================
âœ… æ‰€æœ‰ä¿®å¤ä»£ç éƒ½å·²å­˜åœ¨ï¼

å»ºè®®æ“ä½œï¼š
1. é‡å¯æœåŠ¡å™¨ï¼špm2 restart knowledge-base
2. æµ‹è¯•å¤‡ä»½ï¼šnode server/scripts/testBackupNow.js
============================================================
```

### æ­¥éª¤ 6: é‡å¯æœåŠ¡

```bash
pm2 restart knowledge-base
```

### æ­¥éª¤ 7: æµ‹è¯•å¤‡ä»½åŠŸèƒ½

```bash
node scripts/testBackupNow.js
```

é¢„æœŸçœ‹åˆ°ï¼š
```
ğŸš€ å¼€å§‹åˆ›å»ºæµ‹è¯•å¤‡ä»½...
============================================================
ğŸš€ å¼€å§‹åˆ›å»ºå¤‡ä»½
============================================================
å¤‡ä»½ID: backup_2024-XX-XX...
ç±»å‹: manual
ç‰ˆæœ¬: 1.0.0
ğŸ’¾ ç£ç›˜ç©ºé—´: ...
ğŸ“¦ å¼€å§‹å¤‡ä»½æ•°æ®åº“...
âš ï¸  mongodump ä¸å¯ç”¨ï¼Œå°è¯•ä½¿ç”¨åŸç”Ÿé©±åŠ¨å¤‡ä»½...
ğŸ“Š æ‰¾åˆ° X ä¸ªé›†åˆ
  å¤‡ä»½é›†åˆ: users
  âœ… users: XX æ¡è®°å½•
  å¤‡ä»½é›†åˆ: systemconfigs
  âœ… systemconfigs: XX æ¡è®°å½•
  ...
âœ… æ•°æ®åº“å¤‡ä»½å®Œæˆï¼ˆä½¿ç”¨åŸç”Ÿé©±åŠ¨ï¼‰
ğŸ“ å¼€å§‹å¤‡ä»½æ–‡ä»¶...
âš™ï¸  å¼€å§‹å¤‡ä»½é…ç½®...
ğŸ’» å¼€å§‹å¤‡ä»½åç«¯ä»£ç ...
ğŸ¨ å¼€å§‹å¤‡ä»½å‰ç«¯ä»£ç ...
ğŸ—œï¸  å¼€å§‹å‹ç¼©å¤‡ä»½...
âœ… å¤‡ä»½å‹ç¼©å®Œæˆï¼Œå¤§å°: X.XX MB
============================================================
âœ… å¤‡ä»½åˆ›å»ºæˆåŠŸ
============================================================
```

### æ­¥éª¤ 8: éªŒè¯å¤‡ä»½å†…å®¹

```bash
node scripts/checkBackupContent.js
```

è¿™ä¼šæ˜¾ç¤ºæœ€æ–°å¤‡ä»½çš„è¯¦ç»†å†…å®¹ï¼Œç¡®ä¿æ•°æ®åº“æ–‡ä»¶ä¸ä¸ºç©ºã€‚

## ğŸ¯ æˆåŠŸæ ‡å¿—

âœ… `checkProductionBackupService.js` æ˜¾ç¤ºæ‰€æœ‰æ£€æŸ¥é€šè¿‡
âœ… æœåŠ¡é‡å¯æˆåŠŸ
âœ… æµ‹è¯•å¤‡ä»½æ˜¾ç¤º"ä½¿ç”¨åŸç”Ÿé©±åŠ¨"å¤‡ä»½æ•°æ®åº“
âœ… å¤‡ä»½æ–‡ä»¶å¤§å° > 0 MB
âœ… æ•°æ®åº“é›†åˆéƒ½æœ‰è®°å½•æ•°

## ğŸ”§ å¦‚æœé‡åˆ°é—®é¢˜

### é—®é¢˜ 1: Git pull å¤±è´¥

```bash
# å¦‚æœæœ‰æœ¬åœ°ä¿®æ”¹å†²çª
git stash
git pull origin main
git stash pop
```

### é—®é¢˜ 2: æƒé™é—®é¢˜

```bash
# ç¡®ä¿æœ‰æ‰§è¡Œæƒé™
chmod +x server/scripts/*.js
```

### é—®é¢˜ 3: PM2 é‡å¯å¤±è´¥

```bash
# æŸ¥çœ‹æ—¥å¿—
pm2 logs knowledge-base

# å®Œå…¨é‡å¯
pm2 delete knowledge-base
pm2 start server/index.js --name knowledge-base
```

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœéƒ¨ç½²è¿‡ç¨‹ä¸­é‡åˆ°ä»»ä½•é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. æ‰§è¡Œçš„å‘½ä»¤
2. å®Œæ•´çš„é”™è¯¯ä¿¡æ¯
3. `pm2 logs knowledge-base` çš„è¾“å‡º

---

**å‡†å¤‡å¥½äº†å—ï¼Ÿ** ç°åœ¨å°±å»ç”Ÿäº§æœåŠ¡å™¨æ‰§è¡Œè¿™äº›æ­¥éª¤å§ï¼ ğŸš€
