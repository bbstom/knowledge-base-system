# å¿«é€Ÿä¿®å¤æŒ‡å—

## ğŸš€ ç«‹å³æ‰§è¡Œçš„ä¿®å¤æ­¥éª¤

### 1. ä¿®å¤æ»šåŠ¨æ¡é—®é¢˜

**åŸå› **: CSSä¿®æ”¹éœ€è¦é‡æ–°æ„å»ºå‰ç«¯

**è§£å†³æ­¥éª¤**:

```bash
# åœ¨å®¢æˆ·ç«¯ç›®å½•
cd /www/wwwroot/knowledge-base-system/client

# é‡æ–°æ„å»ºå‰ç«¯
npm run build

# æˆ–è€…åœ¨å¼€å‘ç¯å¢ƒ
npm run dev
```

**éªŒè¯**:
- åˆ·æ–°æµè§ˆå™¨ï¼ˆCtrl + Shift + R å¼ºåˆ¶åˆ·æ–°ï¼‰
- æ£€æŸ¥ç™»å½•é¡µé¢æ˜¯å¦è¿˜æœ‰æ»šåŠ¨æ¡

### 2. ä¿®å¤é€šçŸ¥APIå¤±è´¥é—®é¢˜

**é”™è¯¯**: `Failed to fetch` - åç«¯APIæ— å“åº”

**åŸå› **: åç«¯æœåŠ¡å¯èƒ½æ²¡æœ‰é‡å¯ï¼Œæ–°çš„è·¯ç”±æ²¡æœ‰ç”Ÿæ•ˆ

**è§£å†³æ­¥éª¤**:

```bash
# æ–¹æ³•1: ä½¿ç”¨PM2é‡å¯
pm2 restart server

# æ–¹æ³•2: å¦‚æœæ˜¯å¼€å‘ç¯å¢ƒ
cd /www/wwwroot/knowledge-base-system/server
npm run dev

# æ–¹æ³•3: æ£€æŸ¥æœåŠ¡çŠ¶æ€
pm2 status
pm2 logs server --lines 50
```

**éªŒè¯APIæ˜¯å¦æ­£å¸¸**:

```bash
# æ–¹æ³•1: ä½¿ç”¨curlæµ‹è¯•
curl http://localhost:3001/api/notifications/public

# æ–¹æ³•2: ä½¿ç”¨æµ‹è¯•è„šæœ¬
cd /www/wwwroot/knowledge-base-system/client
node test-notification-api.js

# æ–¹æ³•3: æµè§ˆå™¨ç›´æ¥è®¿é—®
# æ‰“å¼€: http://localhost:3001/api/notifications/public
# æˆ–: http://ä½ çš„åŸŸå/api/notifications/public
```

**é¢„æœŸå“åº”**:
```json
{
  "success": true,
  "data": [
    {
      "_id": "...",
      "title": "æ¬¢è¿ä½¿ç”¨",
      "content": "...",
      "showTiming": "before_login",
      "status": "active",
      ...
    }
  ]
}
```

### 3. åˆ›å»ºæµ‹è¯•é€šçŸ¥

å¦‚æœAPIæ­£å¸¸ä½†æ²¡æœ‰é€šçŸ¥ï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªï¼š

**æ­¥éª¤**:
1. ç™»å½•ç®¡ç†å‘˜è´¦å·
2. è¿›å…¥"é€šçŸ¥ç®¡ç†"
3. ç‚¹å‡»"åˆ›å»ºé€šçŸ¥"
4. å¡«å†™ä¿¡æ¯ï¼š
   - æ ‡é¢˜: `æ¬¢è¿ä½¿ç”¨æˆ‘ä»¬çš„ç³»ç»Ÿ`
   - å†…å®¹: `æ„Ÿè°¢æ‚¨çš„è®¿é—®ï¼`
   - **æ˜¾ç¤ºæ—¶æœº**: é€‰æ‹© `ç”¨æˆ·ç™»å½•å‰` âš ï¸ é‡è¦
   - **çŠ¶æ€**: é€‰æ‹© `ç”Ÿæ•ˆä¸­` âš ï¸ é‡è¦
   - ä¼˜å…ˆçº§: `ä¸­`
   - ç›®æ ‡ç”¨æˆ·: `æ‰€æœ‰ç”¨æˆ·`
5. ä¿å­˜
6. é€€å‡ºç™»å½•
7. åˆ·æ–°ç™»å½•é¡µé¢

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜1: åç«¯æœåŠ¡æœªå¯åŠ¨

**ç—‡çŠ¶**: `Failed to fetch`, `ECONNREFUSED`

**æ£€æŸ¥**:
```bash
# æ£€æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨
netstat -tulpn | grep 3001

# æˆ–
lsof -i :3001

# æ£€æŸ¥PM2çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs server --lines 100
```

**è§£å†³**:
```bash
# å¯åŠ¨æœåŠ¡
pm2 start server

# æˆ–é‡å¯
pm2 restart server
```

### é—®é¢˜2: ç«¯å£ä¸åŒ¹é…

**ç—‡çŠ¶**: APIè¯·æ±‚åˆ°é”™è¯¯çš„ç«¯å£

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹.envé…ç½®
cat server/.env | grep PORT

# åº”è¯¥æ˜¾ç¤º: PORT=3001
```

**è§£å†³**:
å¦‚æœç«¯å£ä¸æ˜¯3001ï¼Œä¿®æ”¹æµ‹è¯•æ–‡ä»¶ä¸­çš„ç«¯å£å·ï¼Œæˆ–ä¿®æ”¹.envæ–‡ä»¶ã€‚

### é—®é¢˜3: CORSé—®é¢˜

**ç—‡çŠ¶**: `CORS policy` é”™è¯¯

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹server/index.jsä¸­çš„CORSé…ç½®
grep -A 10 "cors" server/index.js
```

**è§£å†³**:
ç¡®ä¿CORSé…ç½®åŒ…å«å‰ç«¯åŸŸåã€‚

### é—®é¢˜4: æ•°æ®åº“è¿æ¥é—®é¢˜

**ç—‡çŠ¶**: APIè¿”å›500é”™è¯¯

**æ£€æŸ¥**:
```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs server --lines 50

# æ£€æŸ¥æ•°æ®åº“è¿æ¥
node server/scripts/fix-referral-count-simple.cjs
```

**è§£å†³**:
æ£€æŸ¥.envä¸­çš„æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚

## ğŸ“‹ å®Œæ•´æ£€æŸ¥æ¸…å•

### åç«¯æ£€æŸ¥

- [ ] åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ (`pm2 status`)
- [ ] ç«¯å£3001å¯è®¿é—®
- [ ] æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] é€šçŸ¥è·¯ç”±å·²æ³¨å†Œ
- [ ] `/api/notifications/public` è¿”å›200

### å‰ç«¯æ£€æŸ¥

- [ ] å‰ç«¯å·²é‡æ–°æ„å»º (`npm run build`)
- [ ] æµè§ˆå™¨ç¼“å­˜å·²æ¸…é™¤ (Ctrl + Shift + R)
- [ ] CSSç±»åæ­£ç¡®åº”ç”¨ (h-screen, overflow-hidden)
- [ ] LoginNotificationModalç»„ä»¶å·²åŠ è½½

### é€šçŸ¥æ£€æŸ¥

- [ ] è‡³å°‘æœ‰ä¸€ä¸ªé€šçŸ¥å­˜åœ¨
- [ ] é€šçŸ¥çš„ `showTiming` æ˜¯ `before_login`
- [ ] é€šçŸ¥çš„ `status` æ˜¯ `active`
- [ ] é€šçŸ¥çš„æ—¥æœŸåœ¨æœ‰æ•ˆæœŸå†…
- [ ] æ²¡æœ‰å‹¾é€‰"ä»Šæ—¥ä¸å†æ˜¾ç¤º"

## ğŸ§ª æµ‹è¯•å‘½ä»¤

### æµ‹è¯•åç«¯API
```bash
# æ–¹æ³•1: curl
curl http://localhost:3001/api/notifications/public

# æ–¹æ³•2: Node.jsè„šæœ¬
node test-notification-api.js

# æ–¹æ³•3: æµè§ˆå™¨
# è®¿é—®: http://localhost:3001/api/notifications/public
```

### æµ‹è¯•å‰ç«¯
```bash
# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# é¢„è§ˆæ„å»ºç»“æœ
npm run preview
```

### æ¸…é™¤ç¼“å­˜
```bash
# æ¸…é™¤localStorage
# åœ¨æµè§ˆå™¨æ§åˆ¶å°æ‰§è¡Œ:
localStorage.removeItem('login_notification_hidden_date')

# æ¸…é™¤æ‰€æœ‰localStorage
localStorage.clear()
```

## ğŸ¯ é¢„æœŸç»“æœ

### æ»šåŠ¨æ¡ä¿®å¤å
- âœ… ç™»å½•é¡µé¢å®Œå…¨é€‚é…å±å¹•
- âœ… æ²¡æœ‰å‚ç›´æ»šåŠ¨æ¡
- âœ… å†…å®¹å±…ä¸­æ˜¾ç¤º
- âœ… å“åº”å¼å¸ƒå±€æ­£å¸¸

### é€šçŸ¥åŠŸèƒ½æ­£å¸¸å
- âœ… è®¿é—®ç™»å½•é¡µé¢è‡ªåŠ¨å¼¹å‡ºé€šçŸ¥
- âœ… å¯ä»¥æŸ¥çœ‹å¤šæ¡é€šçŸ¥
- âœ… å¯ä»¥å…³é—­é€šçŸ¥
- âœ… "ä»Šæ—¥ä¸å†æ˜¾ç¤º"åŠŸèƒ½æ­£å¸¸

## ğŸ“ å¦‚æœä»ç„¶å¤±è´¥

### æ”¶é›†ä¿¡æ¯

1. **åç«¯æ—¥å¿—**:
```bash
pm2 logs server --lines 100 > backend-logs.txt
```

2. **å‰ç«¯æ§åˆ¶å°**:
- æ‰“å¼€æµè§ˆå™¨F12
- å¤åˆ¶Consoleä¸­çš„æ‰€æœ‰é”™è¯¯ä¿¡æ¯

3. **ç½‘ç»œè¯·æ±‚**:
- F12 â†’ Networkæ ‡ç­¾
- åˆ·æ–°é¡µé¢
- æŸ¥çœ‹ `/api/notifications/public` è¯·æ±‚
- å¤åˆ¶è¯·æ±‚å’Œå“åº”ä¿¡æ¯

4. **ç¯å¢ƒä¿¡æ¯**:
```bash
# Nodeç‰ˆæœ¬
node -v

# PM2çŠ¶æ€
pm2 status

# ç«¯å£å ç”¨
netstat -tulpn | grep 3001
```

### é‡æ–°éƒ¨ç½²

å¦‚æœä»¥ä¸Šéƒ½ä¸è¡Œï¼Œå°è¯•å®Œå…¨é‡æ–°éƒ¨ç½²ï¼š

```bash
# 1. åœæ­¢æ‰€æœ‰æœåŠ¡
pm2 stop all

# 2. æ‹‰å–æœ€æ–°ä»£ç 
cd /www/wwwroot/knowledge-base-system
git pull origin main

# 3. å®‰è£…ä¾èµ–
cd client
npm install

cd ../server
npm install

# 4. æ„å»ºå‰ç«¯
cd ../client
npm run build

# 5. é‡å¯æœåŠ¡
pm2 restart all

# 6. æŸ¥çœ‹çŠ¶æ€
pm2 status
pm2 logs --lines 50
```

---

**åˆ›å»ºæ—¶é—´**: 2024-11-16
**é€‚ç”¨åœºæ™¯**: ç™»å½•é¡µé¢æ»šåŠ¨æ¡å’Œé€šçŸ¥åŠŸèƒ½é—®é¢˜
**ä¼˜å…ˆçº§**: ğŸ”¥ é«˜
