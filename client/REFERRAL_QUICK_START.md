# é‚€è¯·è¿½è¸ªç³»ç»Ÿ - å¿«é€Ÿå¼€å§‹

## ğŸ¯ å¿«é€Ÿæµ‹è¯•

### 1. åˆå§‹åŒ–ç³»ç»Ÿï¼ˆé¦–æ¬¡è¿è¡Œï¼‰

```bash
cd server
npm run test:referral:init
```

è¿™ä¼šï¼š
- âœ… åˆ›å»ºå¿…è¦çš„æ•°æ®åº“é›†åˆ
- âœ… åˆ›å»ºç´¢å¼•
- âœ… æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
- âœ… è¿è¡ŒåŸºæœ¬åŠŸèƒ½æµ‹è¯•

### 2. å¿«é€Ÿæ£€æŸ¥ç³»ç»ŸçŠ¶æ€

```bash
npm run test:referral:quick
```

æŸ¥çœ‹ï¼š
- ç”¨æˆ·ç»Ÿè®¡
- è®¿é—®è®°å½•
- è½¬åŒ–æ•°æ®
- æ¨èæ’è¡Œæ¦œ

### 3. å®Œæ•´åŠŸèƒ½æµ‹è¯•

**ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ**ï¼Œç„¶ååœ¨å¦ä¸€ä¸ªç»ˆç«¯ï¼š

```bash
npm run test:referral
```

è¿™ä¼šæµ‹è¯•å®Œæ•´çš„é‚€è¯·æµç¨‹ï¼š
- åˆ›å»ºæ¨èäºº
- è¿½è¸ªè®¿é—®
- æ³¨å†Œè½¬åŒ–
- ä½£é‡‘å‘æ”¾
- æ€§èƒ½æµ‹è¯•

---

## ğŸ“ æ‰‹åŠ¨æµ‹è¯•ç¤ºä¾‹

### ä½¿ç”¨ curl æµ‹è¯•

```bash
# 1. è¿½è¸ªè®¿é—®
curl -X POST http://localhost:3001/api/referral/track \
  -H "Content-Type: application/json" \
  -d '{
    "referralCode": "2D371H",
    "fingerprint": "test_fp_001"
  }'

# 2. è·å–é‚€è¯·ç 
curl -X POST http://localhost:3001/api/referral/get-code \
  -H "Content-Type: application/json" \
  -d '{
    "fingerprint": "test_fp_001"
  }'

# 3. æ³¨å†Œæ–°ç”¨æˆ·ï¼ˆä½¿ç”¨é‚€è¯·ç ï¼‰
curl -X POST http://localhost:3001/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{
    "username": "newuser",
    "email": "newuser@test.com",
    "password": "Test123456",
    "referralCode": "2D371H"
  }'
```

### ä½¿ç”¨ Postman æµ‹è¯•

1. **å¯¼å…¥é›†åˆ**: åˆ›å»ºæ–°çš„ Postman Collection
2. **æ·»åŠ è¯·æ±‚**:
   - POST `/api/referral/track` - è¿½è¸ªè®¿é—®
   - POST `/api/referral/get-code` - è·å–é‚€è¯·ç 
   - POST `/api/auth/register` - æ³¨å†Œï¼ˆå¸¦é‚€è¯·ç ï¼‰

---

## ğŸ” éªŒè¯ç»“æœ

### åœ¨æ•°æ®åº“ä¸­æŸ¥çœ‹

```javascript
// MongoDB Shell
use userdata

// æŸ¥çœ‹è®¿é—®è®°å½•
db.referralvisits.find().pretty()

// æŸ¥çœ‹ç”¨æˆ·æ¨èç»Ÿè®¡
db.users.find({ 
  "referralStats.totalReferrals": { $gt: 0 } 
}).pretty()

// æŸ¥çœ‹ä½£é‡‘è®°å½•
db.balancelogs.find({ 
  type: "referral_reward" 
}).pretty()
```

---

## ğŸ“Š æµ‹è¯•ç»“æœç¤ºä¾‹

### æˆåŠŸçš„æµ‹è¯•è¾“å‡º

```
ğŸš€ å¼€å§‹é‚€è¯·è¿½è¸ªç³»ç»Ÿæµ‹è¯•
============================================================
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ

ğŸ“‹ å¼€å§‹æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹

âœ… PASS - åˆ›å»ºæ¨èäºº
   é‚€è¯·ç : ABC123
âœ… PASS - è¿½è¸ªè®¿é—®
   è®¿é—®è®°å½•å·²åˆ›å»º
âœ… PASS - è®¿é—®è®°å½•éªŒè¯
   è®¿é—®æ¬¡æ•°: 1
âœ… PASS - é‡å¤è®¿é—®è®¡æ•°
   è®¿é—®æ¬¡æ•°: 2
âœ… PASS - è·å–é‚€è¯·ç 
   é‚€è¯·ç : ABC123
âœ… PASS - è¢«é‚€è¯·äººæ³¨å†Œ
   ç”¨æˆ·ID: 507f1f77bcf86cd799439011
âœ… PASS - è½¬åŒ–çŠ¶æ€æ›´æ–°
   è½¬åŒ–æ—¶é—´: 2024-10-24T10:30:00.000Z
âœ… PASS - æ¨èäººç»Ÿè®¡
   æ€»æ¨èæ•°: 1
âœ… PASS - ä½£é‡‘è®°å½•
   ä½£é‡‘é‡‘é¢: 10
âœ… PASS - æ¨èå…³ç³»
   æ¨èå…³ç³»æ­£ç¡®
âœ… PASS - å¹¶å‘è®¿é—®
   æˆåŠŸ: 10/10, è€—æ—¶: 234ms

============================================================
ğŸ“Š æµ‹è¯•æŠ¥å‘Š
============================================================
æ€»æµ‹è¯•æ•°: 12
âœ… é€šè¿‡: 12
âŒ å¤±è´¥: 0
æˆåŠŸç‡: 100.00%
============================================================
```

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜1: æ•°æ®åº“è¿æ¥å¤±è´¥

**è§£å†³æ–¹æ³•**:
```bash
# æ£€æŸ¥ .env æ–‡ä»¶
cat server/.env | grep MONGO

# ç¡®ä¿ USER_MONGO_URI é…ç½®æ­£ç¡®
```

### é—®é¢˜2: æœåŠ¡å™¨æœªå¯åŠ¨

**è§£å†³æ–¹æ³•**:
```bash
# å¯åŠ¨æœåŠ¡å™¨
cd server
npm start

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯è¿è¡Œæµ‹è¯•
npm run test:referral
```

### é—®é¢˜3: é‚€è¯·ç ä¸å­˜åœ¨

**è§£å†³æ–¹æ³•**:
```bash
# å…ˆè¿è¡Œåˆå§‹åŒ–è„šæœ¬æŸ¥çœ‹å¯ç”¨é‚€è¯·ç 
npm run test:referral:init

# ä½¿ç”¨è¾“å‡ºä¸­æ˜¾ç¤ºçš„é‚€è¯·ç è¿›è¡Œæµ‹è¯•
```

---

## ğŸ“ˆ æ€§èƒ½åŸºå‡†

é¢„æœŸæ€§èƒ½æŒ‡æ ‡ï¼š
- **è®¿é—®è¿½è¸ª**: < 100ms
- **æ³¨å†Œè½¬åŒ–**: < 500ms
- **å¹¶å‘å¤„ç†**: 100+ QPS
- **æ•°æ®åº“æŸ¥è¯¢**: < 50ms

---

## âœ… æµ‹è¯•æ£€æŸ¥æ¸…å•

- [ ] ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸ
- [ ] è®¿é—®è¿½è¸ªæ­£å¸¸
- [ ] é‚€è¯·ç è·å–æ­£å¸¸
- [ ] æ³¨å†Œè½¬åŒ–è§¦å‘
- [ ] ä½£é‡‘æ­£ç¡®å‘æ”¾
- [ ] æ¨èå…³ç³»å»ºç«‹
- [ ] æ€§èƒ½æµ‹è¯•é€šè¿‡

---

## ğŸš€ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰æ£€æŸ¥

1. [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
2. [ ] æ•°æ®åº“ç´¢å¼•å·²åˆ›å»º
3. [ ] é€Ÿç‡é™åˆ¶å·²é…ç½®
4. [ ] ç›‘æ§å‘Šè­¦å·²è®¾ç½®
5. [ ] å¤‡ä»½ç­–ç•¥å·²åˆ¶å®š

---

## ğŸ“ éœ€è¦å¸®åŠ©ï¼Ÿ

æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š
- `REFERRAL_TESTING_GUIDE.md` - å®Œæ•´æµ‹è¯•æŒ‡å—
- `REFERRAL_TRACKING_SYSTEM_COMPLETE.md` - ç³»ç»Ÿè¯´æ˜
- `REFERRAL_TRACKING_DEPLOYMENT_GUIDE.md` - éƒ¨ç½²æŒ‡å—
