# ðŸ”§ ç”Ÿäº§çŽ¯å¢ƒ .env é…ç½®ä¿®å¤

## é—®é¢˜
```
âŒ æ•°æ®åº“åˆå§‹åŒ–å¤±è´¥: USER_MONGO_URI æœªåœ¨ .env ä¸­é…ç½®
```

## å¿«é€Ÿä¿®å¤

åœ¨ç”Ÿäº§æœåŠ¡å™¨ä¸Šæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
cd /var/www/html/knowledge-base-system/client/server
cat .env
```

æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦åŒ…å«ä»¥ä¸‹å¿…éœ€é…ç½®ï¼š

### å¿…éœ€çš„çŽ¯å¢ƒå˜é‡

```bash
# ç”¨æˆ·æ•°æ®åº“è¿žæŽ¥ï¼ˆå¿…éœ€ï¼‰
USER_MONGO_URI=mongodb://127.0.0.1:27017/userdata

# JWTå¯†é’¥ï¼ˆå¿…éœ€ï¼‰
JWT_SECRET=your-secret-key-here

# æœåŠ¡å™¨ç«¯å£
PORT=3001

# NodeçŽ¯å¢ƒ
NODE_ENV=production
```

## ä¿®å¤æ­¥éª¤

### 1. ç¼–è¾‘ .env æ–‡ä»¶

```bash
cd /var/www/html/knowledge-base-system/client/server
nano .env
```

### 2. æ·»åŠ ç¼ºå¤±çš„é…ç½®

ç¡®ä¿åŒ…å«ä»¥ä¸‹å†…å®¹ï¼ˆæ ¹æ®å®žé™…æƒ…å†µä¿®æ”¹ï¼‰ï¼š

```env
# æ•°æ®åº“é…ç½®
USER_MONGO_URI=mongodb://127.0.0.1:27017/userdata

# å¦‚æžœ MongoDB æœ‰è®¤è¯ï¼Œä½¿ç”¨è¿™ç§æ ¼å¼ï¼š
# USER_MONGO_URI=mongodb://username:password@127.0.0.1:27017/userdata

# JWT é…ç½®
JWT_SECRET=your-very-secret-key-change-this-in-production

# æœåŠ¡å™¨é…ç½®
PORT=3001
NODE_ENV=production

# å…¶ä»–é…ç½®ï¼ˆå¦‚æžœéœ€è¦ï¼‰
SKIP_SLOW_COLLECTIONS=false
```

### 3. ä¿å­˜å¹¶é€€å‡º
- æŒ‰ `Ctrl + O` ä¿å­˜
- æŒ‰ `Enter` ç¡®è®¤
- æŒ‰ `Ctrl + X` é€€å‡º

### 4. é‡å¯æœåŠ¡å™¨

```bash
pm2 restart 0
```

### 5. éªŒè¯ä¿®å¤

```bash
# æŸ¥çœ‹æœåŠ¡å™¨æ—¥å¿—
pm2 logs 0 --lines 50

# åº”è¯¥çœ‹åˆ°ï¼š
# âœ… ä½¿ç”¨é»˜è®¤é…ç½®è¿žæŽ¥ç”¨æˆ·æ•°æ®åº“æˆåŠŸ
# âœ… æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ
```

## é‡è¦è¯´æ˜Ž

### å…³äºŽæ•°æ®åº“é…ç½®çš„ä¸¤ç§æ–¹å¼

ä½ çš„ç³»ç»Ÿæ”¯æŒä¸¤ç§æ•°æ®åº“é…ç½®æ–¹å¼ï¼š

1. **é»˜è®¤é…ç½®ï¼ˆ.env æ–‡ä»¶ï¼‰**
   - æœåŠ¡å™¨å¯åŠ¨æ—¶ä½¿ç”¨
   - å¿…é¡»é…ç½® `USER_MONGO_URI`
   - ç”¨äºŽç”¨æˆ·æ•°æ®åº“è¿žæŽ¥

2. **åŠ¨æ€é…ç½®ï¼ˆç®¡ç†å‘˜åŽå°ï¼‰**
   - è¿è¡Œæ—¶é…ç½®
   - ç”¨äºŽæŸ¥è¯¢æ•°æ®åº“è¿žæŽ¥
   - ä¿å­˜åœ¨ MongoDB çš„ systemconfigs é›†åˆä¸­

**ä¸¤è€…éƒ½éœ€è¦é…ç½®ï¼**

- `.env` ä¸­çš„ `USER_MONGO_URI` â†’ ç”¨æˆ·æ•°æ®åº“ï¼ˆå­˜å‚¨ç”¨æˆ·ã€è®¢å•ç­‰ï¼‰
- ç®¡ç†å‘˜åŽå°é…ç½® â†’ æŸ¥è¯¢æ•°æ®åº“ï¼ˆå­˜å‚¨æœç´¢æ•°æ®ï¼‰

## å®Œæ•´çš„ .env ç¤ºä¾‹

```env
# ============================================
# æ•°æ®åº“é…ç½®
# ============================================
USER_MONGO_URI=mongodb://127.0.0.1:27017/userdata

# ============================================
# å®‰å…¨é…ç½®
# ============================================
JWT_SECRET=change-this-to-a-random-secret-key-in-production

# ============================================
# æœåŠ¡å™¨é…ç½®
# ============================================
PORT=3001
NODE_ENV=production

# ============================================
# æœç´¢ä¼˜åŒ–é…ç½®ï¼ˆå¯é€‰ï¼‰
# ============================================
SKIP_SLOW_COLLECTIONS=false

# ============================================
# å…¶ä»–é…ç½®ï¼ˆæ ¹æ®éœ€è¦æ·»åŠ ï¼‰
# ============================================
# SMTP_HOST=smtp.example.com
# SMTP_PORT=587
# SMTP_USER=your-email@example.com
# SMTP_PASS=your-password
```

## éªŒè¯æ­¥éª¤

### 1. æ£€æŸ¥æ•°æ®åº“è¿žæŽ¥

```bash
cd /var/www/html/knowledge-base-system/client/server
node scripts/diagnoseSearchIssue.js
```

åº”è¯¥çœ‹åˆ°ï¼š
```
âœ… ç”¨æˆ·æ•°æ®åº“å·²è¿žæŽ¥
   æ•°æ®åº“å: userdata
   ä¸»æœº: 127.0.0.1:27017
```

### 2. æµ‹è¯•æœç´¢åŠŸèƒ½

- ç™»å½•å‰ç«¯ç³»ç»Ÿ
- è¿›å…¥æœç´¢é¡µé¢
- è¾“å…¥å…³é”®è¯æœç´¢
- åº”è¯¥èƒ½æ­£å¸¸å·¥ä½œï¼ˆæˆ–æç¤ºéœ€è¦é…ç½®æŸ¥è¯¢æ•°æ®åº“ï¼‰

## ä¸‹ä¸€æ­¥

ä¿®å¤ `.env` åŽï¼Œå¦‚æžœæœç´¢è¿˜æ˜¯ 503 é”™è¯¯ï¼Œè¯´æ˜Žè¿˜éœ€è¦é…ç½®æŸ¥è¯¢æ•°æ®åº“ï¼š

1. ç™»å½•ç®¡ç†å‘˜åŽå°
2. è¿›å…¥"ç³»ç»Ÿè®¾ç½®" â†’ "æ•°æ®åº“é…ç½®"
3. æ·»åŠ æŸ¥è¯¢æ•°æ®åº“
4. é‡å¯æœåŠ¡å™¨

## æ•…éšœæŽ’æŸ¥

### å¦‚æžœè¿˜æ˜¯å¤±è´¥

```bash
# 1. æ£€æŸ¥ MongoDB æœåŠ¡çŠ¶æ€
systemctl status mongod

# 2. æµ‹è¯• MongoDB è¿žæŽ¥
mongo --eval "db.adminCommand('ping')"

# 3. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
mongo
> show dbs
> use userdata
> show collections
> exit

# 4. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
pm2 logs 0 --lines 200
```
