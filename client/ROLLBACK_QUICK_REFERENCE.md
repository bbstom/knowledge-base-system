# 🚀 回滚功能快速参考

## 📌 两种回滚方式

### 1️⃣ 自动回滚
**触发条件**: 升级失败时自动执行
**无需操作**: 系统自动恢复到升级前状态

### 2️⃣ 手动回滚
**触发条件**: 管理员主动执行
**两个入口**: 
- 升级管理页面
- 备份管理页面

## 🎯 快速操作指南

### 从升级管理回滚

```
路径: 管理后台 → 系统管理 → 升级管理

1. 查看升级历史
2. 找到目标版本
3. 点击"回滚"按钮
4. 确认操作
5. 等待完成
6. 重启服务器
```

### 从备份管理回滚

```
路径: 管理后台 → 系统管理 → 备份管理

1. 查看备份列表
2. 找到目标备份
3. 点击"恢复"按钮（🔄 图标）
4. 确认操作
5. 等待完成
6. 重启服务器
```

## ⚡ 一分钟回滚

**最快回滚流程**:
```
1. 进入备份管理 (10秒)
2. 选择最近备份 (5秒)
3. 点击恢复按钮 (5秒)
4. 确认回滚 (5秒)
5. 等待完成 (2-10分钟)
6. 重启服务器 (30秒)
```

## ⚠️ 回滚前必做

1. ✅ **先创建当前备份**
2. ✅ **确认备份存在**
3. ✅ **通知用户**
4. ✅ **选择低峰期**

## 🔍 回滚后必查

1. ✅ **版本号正确**
2. ✅ **系统能启动**
3. ✅ **功能可用**
4. ✅ **数据完整**

## 📊 回滚时间参考

| 数据量 | 预计时间 |
|--------|---------|
| 小型   | 2-3分钟  |
| 中型   | 5-10分钟 |
| 大型   | 10-20分钟|

## 🆘 紧急回滚

**系统崩溃时**:
```bash
# 1. 停止服务器
Ctrl + C

# 2. 手动恢复数据库
mongorestore --host localhost --port 27017 \
  --username admin --password xxx \
  --authenticationDatabase admin \
  --db userdata \
  /path/to/backup/database/userdata

# 3. 恢复配置文件
cp /path/to/backup/config/.env ./server/.env

# 4. 重启服务器
cd server
npm start
```

## 💡 常用命令

### 查看备份列表
```bash
cd server
node scripts/testSystemAPI.js
```

### 手动创建备份
```bash
# 通过管理后台操作
管理后台 → 备份管理 → 创建备份
```

### 查看服务器日志
```bash
# 查看最近的日志
tail -f server/logs/upgrade.log
```

## 🎯 使用场景

| 场景 | 推荐方式 | 优先级 |
|------|---------|--------|
| 升级后有bug | 升级管理回滚 | 🔴 高 |
| 误删数据 | 备份管理回滚 | 🔴 高 |
| 配置错误 | 备份管理回滚 | 🟡 中 |
| 测试回滚 | 备份管理回滚 | 🟢 低 |

## 📞 需要帮助？

- 📖 [详细指南](MANUAL_ROLLBACK_GUIDE.md)
- 📚 [完整文档](BACKUP_UPGRADE_SYSTEM_FINAL.md)
- 🔧 [故障排除](BACKUP_UPGRADE_SYSTEM_GUIDE.md)

---

**记住**: 回滚前先备份，回滚后要验证！ 🎯
