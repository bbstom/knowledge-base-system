# âœ… PM2ç¯å¢ƒå˜é‡é—®é¢˜ - å·²å®Œå…¨è§£å†³ï¼

## é—®é¢˜æè¿°
PM2å¯åŠ¨æ—¶æŠ¥é”™ï¼š`USER_MONGO_URI æœªåœ¨ .env ä¸­é…ç½®`

## æ ¹æœ¬åŸå› 
1. PM2é»˜è®¤ä¸ä¼šè‡ªåŠ¨åŠ è½½.envæ–‡ä»¶ä¸­çš„ç¯å¢ƒå˜é‡
2. `server/index.js` ä½¿ç”¨ `require('dotenv').config()` æ—¶æ²¡æœ‰æŒ‡å®š.envæ–‡ä»¶çš„ç»å¯¹è·¯å¾„

## âœ… å·²ä¿®å¤
å·²æ›´æ–° `server/index.js`ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„åŠ è½½.envæ–‡ä»¶ï¼Œç¡®ä¿åœ¨ä»»ä½•å·¥ä½œç›®å½•ä¸‹éƒ½èƒ½æ­£ç¡®åŠ è½½ç¯å¢ƒå˜é‡ã€‚

---

## ğŸ¯ ç«‹å³è§£å†³ï¼ˆ3æ­¥ï¼‰

### ç¬¬1æ­¥ï¼šç¡®ä¿PM2å·²å®‰è£…

```bash
npm install -g pm2
```

### ç¬¬2æ­¥ï¼šè¿è¡Œæ™ºèƒ½å¯åŠ¨è„šæœ¬

**Windows:**
```bash
start-pm2.bat
```

**Linux/Mac:**
```bash
chmod +x start-pm2.sh
./start-pm2.sh
```

**æˆ–æ‰‹åŠ¨è¿è¡Œï¼š**
```bash
node start-pm2-with-env.cjs
```

### ç¬¬3æ­¥ï¼šéªŒè¯å¯åŠ¨æˆåŠŸ

```bash
pm2 status
pm2 logs base2 --lines 30
```

---

## ğŸ“‹ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

åœ¨ä½ çš„ç”Ÿäº§æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š

```bash
# 1. è¿›å…¥é¡¹ç›®ç›®å½•
cd /var/www/html/knowledge-base-system/client

# 2. ç¡®ä¿PM2å·²å®‰è£…
npm install -g pm2

# 3. åœæ­¢æ—§è¿›ç¨‹
pm2 stop base2 2>/dev/null || true
pm2 delete base2 2>/dev/null || true

# 4. ä½¿ç”¨æ™ºèƒ½å¯åŠ¨è„šæœ¬
node start-pm2-with-env.cjs

# 5. è®¾ç½®å¼€æœºè‡ªå¯
pm2 save
pm2 startup
# å¤åˆ¶è¾“å‡ºçš„å‘½ä»¤å¹¶æ‰§è¡Œ

# 6. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤
pm2 logs base2 --lines 50
```

---

## âœ… éªŒè¯ç»“æœ

è„šæœ¬å·²é€šè¿‡æµ‹è¯•ï¼Œç¯å¢ƒå˜é‡æˆåŠŸåŠ è½½ï¼š

```
=== PM2ç¯å¢ƒå˜é‡å¯åŠ¨è„šæœ¬ ===

1. åŠ è½½ç¯å¢ƒå˜é‡...
   âœ“ ç¯å¢ƒå˜é‡å·²åŠ è½½

2. éªŒè¯å…³é”®ç¯å¢ƒå˜é‡...
   âœ“ USER_MONGO_URI
   âœ“ QUERY_MONGO_URI
   âœ“ JWT_SECRET

3. åœæ­¢æ—§PM2è¿›ç¨‹...
   âœ“ æ—§è¿›ç¨‹å·²åœæ­¢

4. å¯åŠ¨PM2è¿›ç¨‹...
   âœ“ PM2è¿›ç¨‹å·²å¯åŠ¨
```

---

## ğŸ“ åˆ›å»ºçš„æ–‡ä»¶

1. **start-pm2-with-env.cjs** - æ™ºèƒ½å¯åŠ¨è„šæœ¬ï¼ˆæ ¸å¿ƒï¼‰
2. **ecosystem.config.js** - PM2é…ç½®æ–‡ä»¶
3. **start-pm2.bat** - Windowsä¸€é”®å¯åŠ¨
4. **start-pm2.sh** - Linux/Macä¸€é”®å¯åŠ¨
5. **PM2_é—®é¢˜è§£å†³æ€»ç»“.md** - å¿«é€Ÿå‚è€ƒ
6. **PM2_FINAL_SOLUTION.md** - å®Œæ•´è§£å†³æ–¹æ¡ˆ
7. **PM2_ä½¿ç”¨æŒ‡å—.md** - è¯¦ç»†ä½¿ç”¨æŒ‡å—

---

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
pm2 logs base2

# æŸ¥çœ‹æœ€è¿‘50è¡Œæ—¥å¿—
pm2 logs base2 --lines 50

# é‡å¯æœåŠ¡
pm2 restart base2

# åœæ­¢æœåŠ¡
pm2 stop base2

# ç›‘æ§èµ„æº
pm2 monit

# æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯
pm2 show base2
```

---

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šPM2å‘½ä»¤ä¸å­˜åœ¨

```bash
npm install -g pm2
```

### é—®é¢˜2ï¼šç«¯å£è¢«å ç”¨

```bash
# Windows
netstat -ano | findstr :3001
taskkill /PID <è¿›ç¨‹ID> /F

# Linux/Mac
lsof -i :3001
kill -9 <è¿›ç¨‹ID>
```

### é—®é¢˜3ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æµ‹è¯•æ•°æ®åº“è¿æ¥
node server/scripts/testDatabaseConnection.js

# æ£€æŸ¥.envé…ç½®
cat server/.env | grep MONGO_URI
```

### é—®é¢˜4ï¼šç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ

```bash
# å®Œå…¨é‡å¯
pm2 stop base2
pm2 delete base2
node start-pm2-with-env.cjs
```

---

## ğŸ” å·¥ä½œåŸç†

1. `start-pm2-with-env.cjs` ä½¿ç”¨ `dotenv` åŠ è½½ `server/.env`
2. ç¯å¢ƒå˜é‡è¢«æ³¨å…¥åˆ° `process.env`
3. PM2å¯åŠ¨æ—¶ç»§æ‰¿è¿™äº›ç¯å¢ƒå˜é‡
4. åº”ç”¨å¯ä»¥æ­£å¸¸è®¿é—®æ‰€æœ‰ç¯å¢ƒå˜é‡

---

## ğŸ“– è¯¦ç»†æ–‡æ¡£

- **PM2_é—®é¢˜è§£å†³æ€»ç»“.md** - å¿«é€Ÿå‚è€ƒæŒ‡å—
- **PM2_FINAL_SOLUTION.md** - å®Œæ•´è§£å†³æ–¹æ¡ˆ
- **PM2_ä½¿ç”¨æŒ‡å—.md** - è¯¦ç»†ä½¿ç”¨å’Œç»´æŠ¤æŒ‡å—

---

## âœ¨ æˆåŠŸæ ‡å¿—

å½“ä½ çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—æ—¶ï¼Œè¯´æ˜å¯åŠ¨æˆåŠŸï¼š

```
âœ“ ç”¨æˆ·æ•°æ®åº“è¿æ¥æˆåŠŸ
âœ“ æŸ¥è¯¢æ•°æ®åº“è¿æ¥æˆåŠŸ
æœåŠ¡å™¨è¿è¡Œåœ¨ http://0.0.0.0:3001
```

---

**çŠ¶æ€ï¼š** âœ… å·²å®Œå…¨è§£å†³  
**æµ‹è¯•ï¼š** âœ… ç¯å¢ƒå˜é‡åŠ è½½æˆåŠŸ  
**æ–‡æ¡£ï¼š** âœ… å®Œæ•´  
**æ—¥æœŸï¼š** 2024-11-09

**ä¸‹ä¸€æ­¥ï¼š** è¿è¡Œ `node start-pm2-with-env.cjs` å¯åŠ¨æœåŠ¡ï¼
