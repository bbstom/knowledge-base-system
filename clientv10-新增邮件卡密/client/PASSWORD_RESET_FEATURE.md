# 密码重置功能说明

## 功能概述

为了解决用户忘记密码的问题，我们实现了一个完整的密码重置解决方案。

## 用户端功能

### 1. 忘记密码引导

**位置：** 用户中心 > 个人资料 > 修改密码

**功能：**
- 在"当前密码"输入框旁边添加了"忘记密码？"链接
- 点击后会提示用户前往"在线工单"页面提交密码重置申请
- 1.5秒后自动跳转到工单页面

**用户流程：**
1. 用户点击"忘记密码？"
2. 看到提示信息："请前往'在线工单'页面提交密码重置申请"
3. 自动跳转到工单页面
4. 用户创建工单，选择"技术支持"或"一般咨询"分类
5. 在工单中说明需要重置密码
6. 等待管理员处理

## 管理员端功能

### 2. 重置用户密码

**位置：** 管理后台 > 用户管理 > 用户详情 > 基本信息

**功能：**
- 在用户详情的"基本信息"标签页顶部添加了"密码管理"区域
- 提供"重置密码"按钮
- 点击后弹出重置密码对话框

**管理员流程：**
1. 在用户管理页面找到需要重置密码的用户
2. 点击"查看详情"按钮
3. 在"基本信息"标签页，点击"重置密码"按钮
4. 在弹出的对话框中输入新密码（至少6位）
5. 确认新密码
6. 点击"确认重置"
7. 系统提示重置成功
8. 通过工单回复或其他安全渠道将新密码告知用户

## 安全提示

### 对于管理员：
- ⚠️ 重置密码后，用户需要使用新密码登录
- ⚠️ 建议通过安全渠道（如工单系统）将新密码告知用户
- ⚠️ 建议提醒用户登录后立即修改密码

### 对于用户：
- 💡 如果忘记密码，请通过工单系统申请重置
- 💡 收到新密码后，请立即登录并修改为自己的密码
- 💡 建议定期更换密码以保证账户安全

## 后端API（待实现）

需要在后端添加以下API：

```javascript
// 管理员重置用户密码
POST /api/admin/users/:userId/reset-password
Headers: Authorization: Bearer <admin_token>
Body: {
  "newPassword": "新密码"
}
Response: {
  "success": true,
  "message": "密码重置成功"
}
```

## 文件修改清单

### 前端文件：

1. **src/pages/Dashboard/Profile.tsx**
   - 在"当前密码"输入框旁添加"忘记密码？"链接
   - 点击后引导用户前往工单页面

2. **src/pages/Admin/UserManagement.tsx**
   - 添加重置密码状态管理
   - 在用户详情的"基本信息"标签页添加"密码管理"区域
   - 添加重置密码模态框
   - 实现 `handleResetPassword` 函数

### 后端文件（待实现）：

1. **server/routes/admin.js** 或 **server/routes/user.js**
   - 添加 `POST /api/admin/users/:userId/reset-password` 路由
   - 验证管理员权限
   - 更新用户密码（需要加密）
   - 记录操作日志

## 使用示例

### 用户场景：
```
用户：我忘记密码了
1. 进入"个人资料" > "修改密码"
2. 点击"忘记密码？"
3. 自动跳转到工单页面
4. 创建工单："忘记密码，请帮忙重置"
5. 等待管理员回复
```

### 管理员场景：
```
管理员：收到用户的密码重置工单
1. 进入"工单管理"查看工单
2. 确认用户身份
3. 进入"用户管理"找到该用户
4. 点击"查看详情"
5. 点击"重置密码"
6. 输入新密码：123456
7. 确认重置
8. 在工单中回复："您的新密码是：123456，请登录后立即修改"
```

## ✅ 已实现：邮箱验证码自助重置

**新功能已上线！** 用户现在可以通过邮箱验证码自助重置密码，详见 `EMAIL_VERIFICATION_SETUP.md`

### 功能特点：
- ✅ 独立的忘记密码页面
- ✅ 6位数字验证码，10分钟有效期
- ✅ 精美的HTML邮件模板
- ✅ 完整的安全验证机制
- ✅ 支持多种邮件服务商（Gmail、QQ、163等）

### 使用方式：
1. 用户点击"忘记密码？"
2. 输入邮箱地址
3. 接收并输入验证码
4. 设置新密码
5. 完成重置

## 未来改进建议

1. **手机验证码重置**
   - 用户通过手机验证码验证身份
   - 验证通过后设置新密码

3. **密码强度检测**
   - 要求密码包含大小写字母、数字、特殊字符
   - 提供密码强度指示器

4. **操作日志**
   - 记录所有密码重置操作
   - 包括操作时间、操作管理员、目标用户等

5. **临时密码**
   - 重置后的密码标记为临时密码
   - 用户首次登录时强制修改密码

## 总结

✅ 用户端：添加"忘记密码"引导，跳转到工单系统
✅ 管理员端：可以在用户详情中直接重置用户密码
⏳ 后端API：需要实现密码重置接口
💡 建议：未来可以添加邮箱/手机验证码自助重置功能
