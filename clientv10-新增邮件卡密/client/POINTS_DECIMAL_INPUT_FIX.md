# 积分配置支持小数输入修复

## 问题描述

管理后台的积分配置页面无法输入小数，只能输入整数。

## 根本原因

输入框使用了 `parseInt()` 函数处理输入值，导致小数被截断为整数。

## 修复方案

### 文件：`src/pages/Admin/PointsConfig.tsx`

**修复内容**:

### 1. 添加 `step="0.01"` 属性

允许输入框接受小数输入：

```typescript
// 修复前
<input
  type="number"
  value={pointsConfig.dailyCheckIn || 0}
  onChange={(e) => onUpdatePointsConfig({ ...pointsConfig, dailyCheckIn: parseInt(e.target.value) })}
/>

// 修复后
<input
  type="number"
  step="0.01"  // ✅ 允许小数输入
  value={pointsConfig.dailyCheckIn || 0}
  onChange={(e) => onUpdatePointsConfig({ ...pointsConfig, dailyCheckIn: parseFloat(e.target.value) || 0 })}
/>
```

### 2. 将 `parseInt()` 改为 `parseFloat()`

正确解析小数值：

```typescript
// 修复前
parseInt(e.target.value)  // 10.5 → 10 ❌

// 修复后
parseFloat(e.target.value) || 0  // 10.5 → 10.5 ✅
```

### 3. 添加默认值保护

防止NaN值：

```typescript
parseFloat(e.target.value) || 0
```

如果输入为空或无效，返回0。

## 修复的字段

### 搜索配置
- ✅ 每次查询所需积分 (`searchCost`)
- ✅ 余额兑换积分汇率 (`exchangeRate`)

### 签到配置
- ✅ 每日签到获得积分 (`dailyCheckIn`)
- ✅ 连续7天奖励 (`consecutiveBonus.day7`)
- ✅ 连续30天奖励 (`consecutiveBonus.day30`)

### 邀请奖励
- ✅ 成功邀请一个用户获得积分 (`referralReward`)
- ✅ 被邀请用户注册奖励 (`referredUserReward`)

### 注册奖励
- ✅ 新用户注册奖励积分 (`registerReward`)

## 使用示例

### 示例1：设置每日签到为10.5积分

1. 进入管理后台 → 系统设置 → 积分配置
2. 找到"每日签到获得积分"
3. 输入 `10.5`
4. 保存配置
5. 用户签到时获得10.5积分

### 示例2：设置注册奖励为99.99积分

1. 找到"新用户注册奖励积分"
2. 输入 `99.99`
3. 保存配置
4. 新用户注册时获得99.99积分

### 示例3：设置余额兑换汇率为12.5

1. 找到"余额兑换积分汇率"
2. 输入 `12.5`
3. 保存配置
4. 1元余额可兑换12.5积分

## 输入验证

### 有效输入
- ✅ 整数：`10`, `100`, `500`
- ✅ 小数：`10.5`, `99.99`, `0.01`
- ✅ 零：`0`

### 无效输入
- ❌ 负数：`-10` （被min="0"限制）
- ❌ 空值：`` （自动转为0）
- ❌ 文本：`abc` （自动转为0）

## 前端显示

### 输入框显示
- 支持输入小数点
- 支持使用上下箭头调整（步长0.01）
- 支持鼠标滚轮调整

### 提示文本更新
所有提示文本都添加了"（支持小数）"说明：

```
用户每次搜索需要消耗的积分数量（支持小数，如 5.5）
邀请的用户注册并完成首次搜索后，邀请人获得的积分（支持小数）
新用户注册时获得的初始积分（支持小数）
```

## 后端兼容性

后端已经支持小数积分：
- ✅ 数据库：MongoDB Number类型支持小数
- ✅ API：所有积分计算都使用Number类型
- ✅ 配置：SystemConfig模型支持小数

无需修改后端代码。

## 测试步骤

1. **测试输入**
   - 打开管理后台 → 积分配置
   - 尝试输入 `10.5`
   - 验证：可以正常输入小数

2. **测试保存**
   - 输入 `10.5`
   - 点击保存
   - 刷新页面
   - 验证：显示为 `10.5`

3. **测试功能**
   - 设置每日签到为 `10.5`
   - 用户签到
   - 验证：提示"签到成功！获得 10.5 积分"
   - 验证：用户积分正确增加10.5

## 注意事项

1. **显示格式**
   - 输入框会显示完整的小数（如 10.5）
   - 不会自动格式化为两位小数

2. **精度限制**
   - 建议最多使用2位小数
   - 过多小数位可能导致显示问题

3. **用户体验**
   - 建议在UI上说明积分支持小数
   - 避免使用过于复杂的小数（如 10.123456）

## 完成时间

2025-10-22

## 状态

✅ 已完成
